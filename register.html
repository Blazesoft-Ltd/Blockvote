<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>BlockVote - Decentralized Voting</title>

    <!-- Bootstrap Core CSS -->
    <link href="asset/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome CSS -->
    <link href="css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Animate CSS -->
    <link href="css/animate.css" rel="stylesheet" >
    
 

    <!-- Custom CSS -->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    
    <!-- Colors CSS -->
    <link rel="stylesheet" type="text/css" href="css/color/green.css">

    <!-- Custom Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    
    
    <!-- Modernizer js -->
    <script src="js/modernizr.custom.js"></script>

    
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="index.html">BlockVote</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="index.html">Home</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="register.html">Sign Up</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="dashboard/">Sign in</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#">Vote</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>
    
    
 
    
    
    <!-- Start Call to Action Section -->
    <section id="started" class="call-to-action">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>Create an Account</h1>
                </div>
            </div>
        </div>
    </section>
    <!-- End Call to Action Section -->
    

    
    <!-- Start Portfolio Modal Section -->
        <div class="section-modal modal fade" id="portfolio-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-content">
                <div class="close-modal" data-dismiss="modal">
                    <div class="lr">
                        <div class="rl">
                        </div>
                    </div>
                </div>
                
                <div class="container">
                    <div class="row">
                        <div class="section-title text-center">
                            <h3>Organization Details</h3>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ullamcorper dignissim cras tincidunt lobortis feugiat vivamus at augue. Tellus id interdum velit laoreet id donec ultrices tincidunt arcu. Justo eget magna fermentum iaculis eu non diam.</p>
                        </div>
                    </div>
                    <div class="row">
                        
                        <div class="col-md-6">
                            <img src="images/portfolio/img1.jpg" class="img-responsive" alt="..">
                        </div>
                        <div class="col-md-6">
                            <img src="images/portfolio/img1.jpg" class="img-responsive" alt="..">
                        </div>
                        
                    </div><!-- /.row -->
                </div>                
            </div>
        </div>
        <!-- End Portfolio Modal Section -->
    
    
    <!-- Start About Us Section -->
    <section id="register" class="register">
        <div class="container col-lg-6 col-lg-offset-3">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section-title text-center">
                            <p>Please fill out the form below.</p>
                    </div>
                    <div id="feedback"></div>
                </div>
            </div>
             <div class="row">
                <div class="col-lg-12">
                    <form id="registration-form" data-toggle="validator">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label>Account Name*</label>
                                    <input type="text" id="name" class="form-control" pattern="^[_A-z0-9 ]{1,}$" class="field" placeholder=" Name of account" required>
                                    <p class="help-block text-danger"></p>
                                </div>
                                <div class="form-group">
                                    <label>Minium Quorum*</label>
                                    <input type="text" id="quorum" class="form-control" pattern="^[0-9]{1,}$" class="field" placeholder="Minimum number of participants required" required>
                                    <p class="help-block text-danger"></p>
                                </div>
                                <div class="form-group">
                                    <label>Poll Period*</label>
                                    <input type="text" id="period" class="form-control" pattern="^[0-9]{1,}$" class="field" placeholder="Duration the poll will run" required>
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-lg-12 text-center">
                                <div id="success"></div>
                                <button type="submit" class="btn btn-primary">Create Account</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div><!-- /.container -->
    </section>
    <!-- End About Us Section -->


    <!-- Start Team Member Section -->
    <section id="team" class="team-member-section" style="height: 550px;">

    </section>
    <!-- End Team Member Section -->

    

    <!-- Contact -->
    <section id="contact" class="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title text-center">
                        <h3>Contact Us</h3>
                        <p class="white-text">Get in touch with us.</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <form name="sentMessage" id="contactForm" novalidate>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="Your Name *" id="name" required data-validation-required-message="Please enter your name.">
                                    <p class="help-block text-danger"></p>
                                </div>
                                <div class="form-group">
                                    <input type="email" class="form-control" placeholder="Your Email *" id="email" required data-validation-required-message="Please enter your email address.">
                                    <p class="help-block text-danger"></p>
                                </div>
                                <div class="form-group">
                                    <input type="tel" class="form-control" placeholder="Your Phone" id="phone" required data-validation-required-message="Please enter your phone number.">
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <textarea class="form-control" placeholder="Your Message *" id="message" required data-validation-required-message="Please enter a message."></textarea>
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-lg-12 text-center">
                                <div id="success"></div>
                                <button type="submit" class="btn btn-primary">Send Message</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="footer-contact-info">
                        <h4>Contact info</h4>
                        <ul>
                            <li><strong>E-mail :</strong> info@blockvote.io</li>
                            <li><strong>Phone :</strong> +254-6778776</li>
                            <li><strong>Mobile :</strong> +254-45565378</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4 col-md-offset-4">
                    <div class="footer-contact-info">
                        <h4>Working Hours</h4>
                        <ul>
                            <li><strong>Mon-Fri :</strong> 9 am to 5 pm</li>
                            <li><strong>Sat :</strong> 10 am to 1 pm</li>
                            <li><strong>Sunday :</strong> Closed</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <footer class="style-1">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 col-xs-12">
                        <span class="copyright">Copyright &copy; <a href="">BlockVote</a> 2015</span>
                    </div>
                    <div class="col-md-4 col-xs-12">
                        <div class="footer-social text-center">
                            <ul>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fa fa-facebook-square"></i></a></li>
                                <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                                <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                <li><a href="#"><i class="fa fa-dribbble"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4 col-xs-12">
                        <div class="footer-link">
                            <ul class="pull-right">
                                <li><a href="#">Privacy Policy</a>
                                </li>
                                <li><a href="#">Terms of Use</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </section>


    <div id="loader">
        <div class="spinner">
            <div class="dot1"></div>
            <div class="dot2"></div>
        </div>
    </div>

    

    <!-- jQuery Version 2.1.1 -->
    <script src="js/jquery-2.1.1.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="asset/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/count-to.js"></script>
    <script src="js/jquery.appear.js"></script>
    <script src="js/cbpAnimatedHeader.js"></script>
	<script src="js/jquery.fitvids.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/script.js"></script>
    
    <script src="https://m.blazebay.com/assets/js/validator.js"></script>
    <!--<script src="js/web3.min.js"></script>
    <script src="js/web3.init.js"></script>-->
    <script src="js/common.js"></script>
    
	<script type="text/javascript">
window.addEventListener('load', function() {
    if (typeof web3 !== 'undefined') {
        console.log('web3 is enabled');
        if (web3.currentProvider.isMetaMask === true) {
            console.log('MetaMask is active');
            if(!web3.eth.accounts[0]){
                $('#feedback').html('<div class="alert alert-danger" role="alert"><strong>No Address detected!</strong> Kindly unlock your metamask account then <a href="" class="alert-link">refresh</a> this page to proceed.</div>');
                $('#registration-form input, button').prop('disabled','true');
                return false;              
            }
            
            if($.fn.getNetworkName() !== 'ropsten'){
                $('#feedback').html('<div class="alert alert-danger" role="alert"><strong>Wrong network detected!</strong> Kindly switch to Ropsten Test Network in your metamask then <a href="" class="alert-link">refresh</a> this page to proceed.</div>');
                $('#registration-form input, button').prop('disabled','true');
                return false;               
            }  
            
        } 
        else {
        console.log('web3 is not found');
            $('#feedback').html('<div class="alert alert-danger" role="alert"><strong>Misssig Dependancy!</strong> Kindly install <a href="https://metamask.io/" target="_blank" class="alert-link">MetaMask</a> then <a href="" class="alert-link">refresh</a> this page to proceed.</div>');
            $('#registration-form input, button').prop('disabled','true');
            return false;
        }
    } 
    else {
        console.log('web3 is not found');
        $('#feedback').html('<div class="alert alert-danger" role="alert"><strong>Misssig Dependancy!</strong> Kindly install <a href="https://metamask.io/" target="_blank" class="alert-link">MetaMask</a> then <a href="" class="alert-link">refresh</a> this page to proceed.</div>');
        $('#registration-form').html('');
        return false;
    }  
    
		const contractABI = [{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"minimum_quorum","type":"uint256"},{"name":"election_period","type":"uint256"}],"name":"add_Institution","outputs":[],"payable":false,"type":"function","stateMutability":"nonpayable"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"institute","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function","stateMutability":"view"},{"constant":true,"inputs":[],"name":"registered_institutions","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function","stateMutability":"view"}]
		const contractAddress = '0x8a13b4d8c96c8d6efb07512d9f149733e1971d0f';
		const contractInstance = web3.eth.contract(contractABI).at(contractAddress)

		function getInstitution() {
			var index = 0;
			contractInstance.institute(index, (err,result) => {
				console.log(err, result)
			})
		}

		function getNumInstitutions() {
			var index = 0;
			contractInstance.registered_institutions((err,result) => {
				var numInstitutions = result['c'][0]
				console.log(err, result, numInstitutions)
			})
		}

		$('#registration-form').on('submit',function(e){
			e.preventDefault();
            console.log('form submitted!');
			if(!$.fn.isLoggedIn()){
				$('#feedback').html('Kindly log into your metamask to make this transaction');
				return;
			}
			var name = $("#name").val();
			var minimum_quorum = $("#quorum").val();
			var election_period = $("#period").val();

		    contractInstance.add_Institution(name, minimum_quorum, election_period, (err, txHash) => {
	            var txHashRegex = /^0x([A-Fa-f0-9]{64})$/;
	            if(txHashRegex.test(txHash)){
                    
                    $('#feedback').html('<div class="alert alert-success" role="alert"> <strong>Success!</strong> Your request was submitted. Kindly wait while we fetch the response.</div>');
                    var callback = function(status) {
                      if(status){
                                               
                        $('#feedback').html('<div class="alert alert-success" role="alert"> <strong>Hooray!</strong> The <a target="blank" href="https://ropsten.etherscan.io/tx/'+txHash+'">Transaction</a> was successful. Kindly wait while we generate your account link...</div>');
                        $("#registration-form").trigger('reset');
                        
                        var callback = function(tx) {
                            if(web3.isAddress(tx.contractAddress)){

                                $('#feedback').prepend('<div class="alert alert-info" role="alert"> Access your new <a href="dashboard?account='+tx.contractAddress+'" class="alert-link">account</a> now!</div>');
                            }                            
                        };
                        $.fn.getContractAddress(txHash, contractAddress, callback);
                      }
                      else{
                        $('#feedback').html('Transaction failed <a href="https://ropsten.etherscan.io/tx/'+result+'">'+result+'</a>');
                      }                        
                    };
                    
                    $.fn.txStatus(txHash, callback);            

	            }
	            else{
	              $('#feedback').html('Sorry the transaction failed <a target="blank" href="https://ropsten.etherscan.io/tx/'+result+'">'+result.substring(0,10)+'....</a>'); 
                    $('#feedback').html('<div class="alert alert-danger" role="alert"> <strong>Oops!</strong> Soory, it looks like the <a target="blank" href="https://ropsten.etherscan.io/tx/'+result+'">transaction</a> failed. Please try again.</div>');
	            }
	            console.log(err, txHash);
		    })

		});    
    
    
    
    
    
    
    
    
});        
        
		// Checking if Web3 has been injected by the browser (Mist/MetaMask)
		/*if (typeof web3 == 'undefined') {
            
			// Use the browser's ethereum provider
			var web3 = new Web3(web3.currentProvider);
			// MetaMask is installed but not logged in
            console.log(web3.currentProvider);
            if(typeof web3.currentProvider.isMetaMask === 'undefined'){
                console.log('MetaMask is not installed but not logged in'); 
                return false;
            }
		}
		else {
		  	$('#feedback').html('<div class="alert alert-danger" role="alert"><strong>Misssig Dependancy!</strong> Kindly install <a href="https://metamask.io/" target="_blank" class="alert-link">MetaMask</a>.</div>');
            return false;
		}*/


	</script>

</body>

</html>
